---
import { getEntry } from "astro:content";
import Button from "@components/Button.astro";
import SectionHeader from "@components/SectionHeader.astro";
import Layout from "../layouts/Layout.astro";
import CityCard from "@components/CityCard.astro";
import EventCard from "@components/EventCard.astro";
import NewsCard from "@components/NewsCard.astro";
import ResearchCard from "@components/ResearchCard.astro";
import { getCollection } from "astro:content";
import Navbar from "@components/Navbar.astro";
import Footer from "@components/Footer.astro";
import { getSortedEvents } from "@utils/eventUtils";
import { getSortedNews } from "@utils/newsUtils";
import { getSortedResearch } from "@utils/researchUtils";
import ContentContainer from "@components/ContentContainer.astro";
import EventList from "@components/EventList.astro";
import NewsList from "@components/NewsList.astro";

const { data: allCities } = await getEntry("city", "cities");
const allEvents = getSortedEvents(await getCollection("event"));
const allNews = getSortedNews(await getCollection("news"));
const allResearch = getSortedResearch(await getCollection("research"));
---

<Layout>
  <Navbar />
  <main>
    <div class="relative h-dvh">
      <div class="px-4 h-full flex items-center mx-auto max-w-6xl">
        <div class="w-96">
          <h1 class="text-7xl font-bold">Capitals of the future</h1>
          <p class="mt-8">
            The future of our cities. What's it going to be like?
          </p>
        </div>
      </div>
    </div>
    <ContentContainer class={allCities.length > 6 ? "md:pt-12" : "md:pt-6"}>
      <div
        class:list={[
          "md:h-dvh flex justify-center",
          allCities.length > 6 ? "md:h-auto" : "md:h-dvh items-center",
        ]}
      >
        <div class="max-w-6xl w-full px-4">
          <SectionHeader title="3 cities" />
          <p class="font-bold text-5xl">Many connections.</p>
          <div class="mt-14 grid grid-cols-1 md:grid-cols-3 gap-4">
            {allCities.map((city) => <CityCard {...city} />)}
          </div>
        </div>
      </div>
      <div>
        <div
          class:list={[
            "max-w-6xl px-4 mx-auto mt-16",
            allCities.length > 6 ? "md:mt-16" : "md:mt-2",
          ]}
        >
          <EventList events={allEvents} />
          <SectionHeader title="Latest research" />
          <div class="grid mt-6 grid-cols-1 gap-y-7">
            {allResearch.map((research) => <ResearchCard {...research.data} />)}
          </div>
          <a href="/research">
            <Button label="View all research" class="mt-8 mb-16" />
          </a>
          <NewsList news={allNews} />
        </div>
      </div>
    </ContentContainer>
  </main>
  <Footer />
</Layout>
